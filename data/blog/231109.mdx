---
title: 'AuthenticationEntryPoint'
date: '2023-11-09'
tags: ['Backend']
draft: false
summary: 'AuthenticationEntryPointë¥¼ ì•Œì•„ë³´ì!'
images: []
---

ğŸ¦¡ ì‘ì„±ì : ì›ì¤€

## **AuthenticationEntryPoint**

**AuthenticationEntryPoint**ë€Â **Authorizationí—¤ë”ë¥¼ ë³´ë‚´ì§€ ì•Šê±°ë‚˜ í˜¹ì€ ì¸ì¦ì— ì‹¤íŒ¨**í•˜ì—¬ 401 ì‘ë‹µì½”ë“œê°€ ë°œìƒí•˜ê²Œ ë˜ì—ˆì„ ë•Œ ì²˜ë¦¬í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ, ë‚´ë¶€ì˜Â **`commence()`**Â ê°€ ì‹¤í–‰ë˜ê²Œ ëœë‹¤.

```java
@Component
@RequiredArgsConstructor
public class CustomAuthenticationEntryPoint implements AuthenticationEntryPoint {
    private final ObjectMapper objectMapper;

    @Override
    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException {
        SecurityException.WrongTokenException e = new SecurityException.WrongTokenException(
                JwtConstants.JwtExcpetionMessage.WRONG_TOKEN.getMessage(),
                JwtConstants.JwtExcpetionCode.WRONG_TOKEN.getCode(),
                HttpStatus.FORBIDDEN);

        response.setStatus(e.getHttpStatus().value());
        response.setContentType(MediaType.APPLICATION_JSON_VALUE);
        response.setCharacterEncoding("UTF-8");

        String errorResponseJson = objectMapper.writeValueAsString(new ErrorResponse(e.getErrorCode(), e.getMessage()));
        response.getOutputStream().write(errorResponseJson.getBytes("UTF-8"));
    }
}
```

ìœ„ì˜ ì½”ë“œëŠ”Â **AuthenticationEntryPoint**ë¥¼ êµ¬í˜„í•œ ì»¤ìŠ¤í…€ í´ë˜ìŠ¤ë¡œ, í•´ë‹¹ ì½”ë“œë¥¼ ì‚´í´ë³´ë©´ ì–´ë–»ê²Œ ì²˜ë¦¬í•  ê²ƒì¸ì§€ì— ëŒ€í•´ì„œ ì •ì˜í•˜ê³  ìˆëŠ”ë°, ì»¤ìŠ¤í…€ í•˜ì—¬ ë§Œë“  ì˜ˆì™¸ë¥¼ ìƒì„±í•˜ê³ ,Â **`response`**Â ì— ì ì ˆí•œ ì •ë³´ë¥¼ ë‹´ì•„ì„œ ì‘ë‹µí•˜ê³  ìˆë‹¤.

(WrongTokenException, ErrorResponseëŠ” ì»¤ìŠ¤í…€í•˜ì—¬ ì •ì˜í•œ í´ë˜ìŠ¤)

## **AccessDeniedHandler**

ê·¸ë ‡ë‹¤ë©´Â **AccessDeniedHandler**Â ëŠ” ë¬´ì—‡ì¼ê¹Œ

**AccessDeniedHandler**Â ë€ ì¸ì¦ì€ ë˜ì—ˆì§€ë§Œ ê¶Œí•œì´ ë¶€ì¡±í•œ ê²½ìš° ì¦‰, ì—‘ì„¸ìŠ¤ ê¶Œí•œì„ ì²´í¬í–ˆì„ ë•Œ ì—‘ì„¸ìŠ¤ í•  ìˆ˜ ì—†ëŠ” ìš”ì²­ì„ í–ˆì„ ê²½ìš° ë™ì‘í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ, ë‚´ë¶€ì˜Â **`handler()`**Â ê°€ ì‹¤í–‰ëœë‹¤.

```java
@Slf4j
@Component
@RequiredArgsConstructor
public class CustomAccessDeniedHandler implements AccessDeniedHandler {
    private final ObjectMapper objectMapper;

    @Override
    public void handle(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException) throws IOException, ServletException {
        log.error("ê¶Œí•œì´ ì—†ëŠ” ìš”ì²­ì…ë‹ˆë‹¤.");
        AuthorityException e = new AuthorityException(
                JwtExcpetionMessage.NON_AUTHORITY.getMessage(),
                JwtExcpetionCode.NON_AUTHORITY.getCode(),
                HttpStatus.FORBIDDEN);
        response.setStatus(e.getHttpStatus().value());
        response.setContentType(MediaType.APPLICATION_JSON_VALUE);
        response.setCharacterEncoding("UTF-8");
        String errorResponseJson = objectMapper.writeValueAsString(new ErrorResponse(e.getErrorCode(), e.getMessage()));
        response.getOutputStream().write(errorResponseJson.getBytes("UTF-8"));
    }
}
```

ìœ„ì˜ ì½”ë“œëŠ”Â **AccessDeniedHandler**Â ë¥¼ êµ¬í˜„í•œ ì»¤ìŠ¤í…€ í´ë˜ìŠ¤ë¡œ, ì½”ë“œë¥¼ ì‚´í´ë³´ë©´ ì´ì „ì— ì‚´í´ë³¸Â **`commence()`**Â ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë™ì‘í•˜ê³  ìˆë‹¤.

ì´ë ‡ê²Œ ê²½ìš°ì— ë”°ë¼ì„œ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì£¼ê³ ,

```java
@Override
protected void configure(HttpSecurity http) throws Exception {
    http
		...
            .exceptionHandling()
            .authenticationEntryPoint(customAuthenticationEntryPoint)
            .accessDeniedHandler(customAccessDeniedHandler)
		...
}
```

ì´ë ‡ê²Œ ì„¤ì •ì— ì¶”ê°€í•˜ë©´ ê¶Œí•œ ê²€ì‚¬ë¥¼ ì§„í–‰í•  ê²½ìš° ì‘ë™í•˜ì—¬ ì²˜ë¦¬ë˜ê²Œ ë  ê²ƒì´ë‹¤.
