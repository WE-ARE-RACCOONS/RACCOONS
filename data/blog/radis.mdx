---
title: 'Redisë¥¼ í™œìš©í•œ ë©˜í† ë§ ë™ì‹œì„± ì œì–´'
date: '2024-04-19'
tags: ['Backend']
draft: false
summary: 'Redisë¥¼ í™œìš©í•œ ë©˜í† ë§ ë™ì‹œì„± ì œì–´'
images: []
---

ğŸ¦¡ ì‘ì„±ì : ì›ì¤€

ëŒ€í•™ì› ê¹€ì„ ë°°ê°€ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ ì¤‘ ë©˜í† ë§ì€ ì„ ë°°ì™€ í›„ë°°ê°€ ê°™ì€ ë©˜í† ë§ì— ëŒ€í•´ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

ë”°ë¼ì„œ ì„ ë°°ê°€ ë©˜í† ë§ ìƒíƒœ ë³€ê²½ì„ í•  ë•Œ ë™ì‹œì— í›„ë°°ë„ ìƒíƒœ ë³€ê²½ì„ ì‹œë„í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.

ì´ë ‡ê²Œ ë˜ë©´ ì„ ë°°ëŠ” ìˆ˜ë½ì„ í–ˆì§€ë§Œ, í›„ë°°ëŠ” ë©˜í† ë§ í™˜ë¶ˆ ìš”ì²­ì„ ë³´ë‚´ ë‘˜ ë‹¤ ëŒ€ê¸°ì¤‘ì˜ ë©˜í† ë§ì„ ì¡°íšŒí•œ ê²ƒìœ¼ë¡œ ë˜ì–´ ë³¸ë˜ëŠ” ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ìˆ˜í–‰ë˜ì–´ì•¼ í•˜ì§€ë§Œ ë‘˜ ë‹¤ ì„±ê³µì´ ë˜ì–´ ì—¬ëŸ¬ ë¬¸ì œë¡œ ë²ˆì§ˆ ìˆ˜ ìˆë‹¤.

ì´ëŠ” ëˆì´ ì—°ê²°ëœ ë¬¸ì œì´ë‹¤ ë³´ë‹ˆ ë©˜í† ë§ ìƒíƒœ ë³€ê²½ì„ ë™ì‹œì— ì ‘ê·¼í•  ìˆ˜ ì—†ë„ë¡ ë½ì„ ê±¸ì–´ì„œ í•´ê²°í•˜ê³ ì í•œë‹¤.

**ì—¬ê¸°ì„œ ì‚¬ìš©í•  ë°©ë²•ì€ Redisì˜ Redissonì„ í†µí•œ ë¶„ì‚° ë½ ì´ë‹¤.**

Mysqlì„ í†µí•œ ë½ê³¼ Redisë¥¼ í†µí•œ ë½ ëª¨ë‘ ê°€ëŠ¥í•œ ìƒí™©ì´ì—ˆì§€ë§Œ, í˜„ì¬ ì´ë¯¸ Redisê°€ ë„ì…ë˜ì–´ ì‚¬ìš©ì¤‘ì´ê³  í˜„ì¬ëŠ” ë‹¨ì¼ ì‹œìŠ¤í…œì´ì§€ë§Œ ì¶”í›„ ë¶„ì‚° í™˜ê²½ì´ ë˜ì–´ë„ ìœ ì§€ê°€ ê°€ëŠ¥í•œ ì‹œìŠ¤í…œì„ ìœ„í•´ Redisë¥¼ ì„ íƒí•˜ê²Œ ë˜ì—ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´ ìš°ì„  ë¶„ì‚°ë½ì´ ë¬´ì—‡ì¸ì§€ ì´í•´í•˜ê³  ì§„í–‰í•˜ë„ë¡ í•˜ì.

## ë¶„ì‚°ë½ì´ë€?

ë¶„ì‚°ë½ì´ë€ ì—¬ëŸ¬ ì„œë²„(í”„ë¡œì„¸ìŠ¤)ê°€ ì ‘ê·¼í•˜ëŠ” ê³µìœ  ë°ì´í„°ë¥¼ ì œì–´í•˜ê¸° ìœ„í•œ ê¸°ìˆ ì´ë‹¤.

ë½ì„ íšë“í•œ í”„ë¡œì„¸ìŠ¤ í˜¹ì€ ìŠ¤ë ˆë“œë§Œì´ ê³µìœ  ìì›(Critical Section)ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒìœ¼ë¡œ ë¶„ì‚°ë½ì˜ ì¥ì ì€ ë‹¨ì¼ ì„œë²„ê°€ ì•„ë‹Œ ë¶„ì‚° í™˜ê²½ì—ì„œë„ í”„ë¡œì„¸ìŠ¤ë“¤ì˜ ì›ìì  ì—°ì‚°ì„ ê°€ëŠ¥í•˜ë„ë¡ í•œë‹¤ëŠ” ê²ƒì´ë‹¤.

![](https://efficacious-camel-96c.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F5eda31ee-1593-4ecf-bfad-bae333b90117%2F61e87e09-a23a-4f0d-bca4-b83dc3d8c385%2FUntitled.png?table=block&id=78596c97-3604-48c1-b9c5-1de5b06b87bd&spaceId=5eda31ee-1593-4ecf-bfad-bae333b90117&width=1420&userId=&cache=v2)

## Redisì˜ Redissonì„ ì • ì´ìœ 

ìš°ì„  ë¶„ì‚°ë½ì„ ìœ„í•´ì„œëŠ” Redis, Mysql, Zookeeper ë“±ë“±ì„ í™œìš©í•  ìˆ˜ ìˆë‹¤ê³  í•œë‹¤.

ê·¸ì¤‘ Redisë¥¼ ì„ íƒí•œ ì´ìœ ëŠ” í˜„ì¬ ì‚¬ìš©ì¤‘ì´ê¸° ë•Œë¬¸ì— ì¶”ê°€ì ì¸ ì¸í”„ë¼ ì‘ì—…ì´ í•„ìš” ì—†ê¸° ë•Œë¬¸ì´ë‹¤.

í•˜ì§€ë§Œ ì´ëŸ¬í•œ ì´ìœ ë¼ë©´ Mysql ì—­ì‹œ ì‚¬ìš©ì¤‘ì´ê¸° ë•Œë¬¸ì— ë¶ˆì¶©ë¶„í•œ ì´ìœ ê°€ ë í…ë°, ê°œì¸ì ìœ¼ë¡œ Mysqlì€ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ I/O ì‘ì—…ì´ í•„ìš”í•˜ë‹¤ëŠ” ì ê³¼ RDSì— ë¶€í•˜ë¥¼ ì£¼ëŠ” ê²ƒ ë³´ë‹¤ëŠ” Redisë¥¼ í™œìš©í•˜ëŠ” ê²ƒì´ ë” ë‚«ë‹¤ê³  íŒë‹¨í–ˆê¸° ë•Œë¬¸ì´ë‹¤.

ê·¸ë ‡ê²Œ Redisë¥¼ ì„ íƒí•˜ê²Œ ë˜ì—ˆê³ , Redisì—ì„œ Lockì„ í™œìš©í•  ìˆ˜ ìˆëŠ” ë°©ì‹ì€ Lettuceì™€ Redissonì´ ìˆì§€ë§Œ ê·¸ ì¤‘ì—ì„œ Redissonì„ ì„ íƒí•˜ê²Œ ë˜ì—ˆë‹¤.

ê·¸ ì´ìœ ëŠ” Lettuceê°€ ì œê³µí•˜ëŠ” Lockì˜ ë°©ì‹ ë³´ë‹¤ Redissonì´ ì œê³µí•˜ëŠ” Lockì˜ ë°©ì‹ì´ ë” íš¨ìœ¨ì ì´ê¸° ë•Œë¬¸ì´ë‹¤.

## ë½ íšë“ ë°©ì‹

ìš°ì„ , Lettuceì˜ ê²½ìš° `setnx` ëª…ë ¹ì–´ë¥¼ í†µí•´ ë¶„ì‚°ë½ì„ êµ¬í˜„í•˜ê²Œ ë˜ì–´ìˆëŠ”ë° ì´ëŠ” ë½ì„ íšë“í•˜ë ¤ëŠ” **ìŠ¤ë ˆë“œê°€ ë½ì˜ íšë“ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ë°˜ë³µì ìœ¼ë¡œ í™•ì¸í•˜ëŠ” ìŠ¤í•€ ë½(Spin Lock) ë°©ì‹ì´ë‹¤.**

âš ï¸Â ì´ëŸ¬í•œ ìŠ¤í•€ ë½ì˜ ê²½ìš° ë½ì„ íšë“í•  ìˆ˜ ì—†ë‹¤ë©´ ê³„ì†í•´ì„œ í™•ì¸ì„ í•˜ë©° ì–»ì„ ë•Œ ê¹Œì§€ ê¸°ë‹¤ë¦¬ê²Œ ë˜ëŠ” ì´ë¥¸ë°” Busy Waitingì˜ ë°©ì‹ìœ¼ë¡œ ìˆ˜í–‰ëœë‹¤.

ë”°ë¼ì„œ Lettuceì˜ `setnx` ë¥¼ ì‚¬ìš©í•˜ë©´ ìŠ¤í•€ë½ì„ í™œìš©í•˜ê¸° ë•Œë¬¸ì— Redisì— ì‹¬í•œ ë¶€í•˜ê°€ ê±¸ë¦¬ê²Œ ë˜ë©° ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” `sleep()` ì„ í™œìš©í•œ ìŠ¤ë ˆë“œë¥¼ ì ì‹œ ë©ˆì¶”ëŠ” ê²ƒì´ ë°©ë²•ì¸ë° ì´ëŠ” ì„±ëŠ¥ ì €í•˜ë¥¼ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì— ì¢‹ì§€ ì•Šë‹¤.

ê·¸ë¦¬ê³  ë³„ë„ë¡œ ê°œë°œìê°€ íƒ€ì„ì•„ì›ƒì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ë³„ë„ì˜ íƒ€ì„ì•„ì›ƒì´ ì§€ì •ë˜ì§€ ì•Šì•„ ìì¹«í•˜ë©´ DeadLock ìƒíƒœì— ë¹ ì ¸ ë¬´í•œì • ëŒ€ê¸°í•˜ê²Œ ë˜ëŠ” ìœ„í—˜ì„±ì´ ì¡´ì¬í•œë‹¤.

ë”°ë¼ì„œ Redissonì„ ì‚¬ìš©í•˜ê²Œ ëœ ê²ƒì´ë‹¤.

### Redissonì˜ ë½ íšë“ ë°©ì‹

Redissonì˜ ê²½ìš° ë³„ë„ì˜ Lock Interfaceë¥¼ ì§€ì›í•˜ê³  ìˆë‹¤.

ì´ë¥¼ í†µí•´ ë½ì— ëŒ€í•´ íƒ€ì„ì•„ì›ƒê³¼ ê°™ì€ ì„¤ì •ì„ ì§€ì›í•˜ê¸° ë•Œë¬¸ì— Lettuceë³´ë‹¤ ë½ì„ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

**Redissonì˜ ë½ íšë“ ë°©ì‹ì€ Lettuceì˜ ìŠ¤í•€ ë½ ë°©ì‹ê³¼ ë‹¤ë¥´ê²Œ Pub/Sub ë°©ì‹ì„ ì‚¬ìš©í•œë‹¤.**

ì´ëŠ” ë½ì„ íšë“í•˜ê³ ì í•˜ë©´ Subscribeë¥¼ í•˜ê³  ë½ì´ í•´ì œë˜ë©´ ì‹ í˜¸ë¥¼ ë°›ì•„ ë°”ë¡œ ë½ì„ íšë“í•˜ëŠ” ë°©ì‹ì´ë‹¤.

ì¦‰, ê³„ì†í•´ì„œ ë½ì„ í™•ì¸í•˜ëŠ” ë°©ì‹ê³¼ ë‹¤ë¥´ê²Œ ë½ì´ í•´ì œë˜ë©´ ë½ì´ í•´ì œ ë˜ì—ˆë‹¤ëŠ” ì‹ í˜¸ë¥¼ ë°›ê³  ë½ì„ íšë“í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.

## ë¶„ì‚°ë½ ì ìš©

ê¹€ì„ ë°°ì˜ ë©˜í† ë§ ì—…ë°ì´íŠ¸ ì½”ë“œì— ë¶„ì‚°ë½ì„ ì ìš©í•˜ì—¬ ë™ì‹œì— ë³€ê²½í•˜ì—¬ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì´ìŠˆë¥¼ ë°©ì§€í•´ë³´ì.

ì–´ë–»ê²Œ í•  ìˆ˜ ìˆì„ê¹Œ.

### ê°ê°ì˜ ë©”ì†Œë“œì— ì ìš©

ìš°ì„  ë¶„ì‚°ë½ì´ í•„ìš”í•œ ëª¨ë“  ë©”ì†Œë“œì— ì§ì ‘ ì‘ì„±í•˜ëŠ” ë°©ë²•ì„ ì±„íƒí•  ìˆ˜ ìˆë‹¤.

```java
@Service
@Slf4j
@RequiredArgsConstructor
public class MentoringManageUseCase {
    ...

    public ApplyingResponse applyMentoring(User user, MentoringApplyRequest request) {
        ...
    }

    @Transactional
    public void updateCancel(User user, Long mentoringId) {
        ...
    }

    @Transactional
    public void updateDone(User user, Long mentoringId) {
        ...
    }

    @Transactional
    public void updateRefuse(User user, Long mentoringId, MentoringRefuseRequest request) {
        ...
    }

    @Transactional
    public Boolean updateExpected(User user, Long mentoringId, MentoringDateRequest dateRequest) {
        ...
    }

    @Scheduled(fixedDelay = 1000*60*10)
    @Transactional
    public void sendFinishMessage() {
        ...
    }
}
```

ì´ë ‡ê²Œ ë©”ì†Œë“œê°€ ìˆëŠ”ë°, ì´ ë©”ì†Œë“œë“¤ ì¤‘ ë¶„ì‚°ë½ì´ í•„ìš”í•œ ë©”ì†Œë“œëŠ” `applyMentoring` ê³¼ `sendFinishMesage` ë¥¼ ì œì™¸í•œ ëª¨ë“  ë©”ì†Œë“œë‹¤.

ê·¸ë ‡ë‹¤ë©´ ì´ì œ ì´ ë©”ì†Œë“œë“¤ì— ëª¨ë‘ ì ìš©ì„ í•´ë³´ì.

```java
@Service
@Slf4j
@RequiredArgsConstructor
public class MentoringManageUseCase {
    ...
    private final RedissonClient redissonClient;

    public ApplyingResponse applyMentoring(User user, MentoringApplyRequest request) {
        ...
    }

    @Transactional
    public void updateCancel(User user, Long mentoringId) throws InterruptedException {
        String lockKey = "mentoring" + mentoringId;
        RLock lock = redissonClient.getLock(lockKey);
        try {
            boolean available = lock.tryLock(5, 5, SECONDS);
            if (!available)
                throw new IllegalArgumentException();
            log.info("lock íšë“ {}", lockKey);

            ...

        } catch (Exception ex) {
            log.info("ì˜ˆì™¸ ë°œìƒ {}", ex.getMessage());
            throw ex;
        } finally {
            log.info("lock ë°˜í™˜ {}", lockKey);
            lock.unlock();
        }
    }

    @Transactional
    public void updateDone(User user, Long mentoringId) throws InterruptedException {
        String lockKey = "mentoring" + mentoringId;
        RLock lock = redissonClient.getLock(lockKey);
        try {
            boolean available = lock.tryLock(5, 5, SECONDS);
            if (!available)
                throw new IllegalArgumentException();

            ...

        }
        catch (Exception ex) {
            log.info("ì˜ˆì™¸ ë°œìƒ {}", ex.getMessage());
            throw ex;
        } finally {
            log.info("lock ë°˜í™˜ {}", lockKey);
            lock.unlock();
        }
    }

    @Transactional
    public void updateRefuse(User user, Long mentoringId, MentoringRefuseRequest request) throws InterruptedException {
        String lockKey = "mentoring" + mentoringId;
        RLock lock = redissonClient.getLock(lockKey);
        try {
            boolean available = lock.tryLock(5, 5, SECONDS);
            if (!available)
                throw new IllegalArgumentException();

            ...

        } catch (Exception ex) {
            log.info("ì˜ˆì™¸ ë°œìƒ {}", ex.getMessage());
            throw ex;
        } finally {
            log.info("lock ë°˜í™˜ {}", lockKey);
            lock.unlock();
        }
    }

    @Transactional
    public Boolean updateExpected(User user, Long mentoringId, MentoringDateRequest dateRequest) throws InterruptedException {
        String lockKey = "mentoring" + mentoringId;
        RLock lock = redissonClient.getLock(lockKey);
        try {
            boolean available = lock.tryLock(5, 5, SECONDS);
            if (!available)
                throw new IllegalArgumentException();

            ...

        } catch (Exception ex) {
            log.info("ì˜ˆì™¸ ë°œìƒ {}", ex.getMessage());
            throw ex;
        } finally {
            log.info("lock ë°˜í™˜ {}", lockKey);
            lock.unlock();
        }
    }

    @Scheduled(fixedDelay = 1000*60*10)
    @Transactional
    public void sendFinishMessage() {
        ...
    }
}
```

ì´ë ‡ê²Œ ë©˜í† ë§ ê´€ë ¨ ì‘ì—…ì—ì„œëŠ” Lockì„ íšë“í•˜ê³  ì‘ì—…í•  ìˆ˜ ìˆë„ë¡ í–ˆë‹¤.

í•˜ì§€ë§Œ, ì¤‘ë³µì½”ë“œê°€ ë§ì´ ë³´ì¸ë‹¤.

ì´ê²ƒë“¤ì„ ì œê±°í•˜ë©´ ë¹„êµì  ê¹”ë”í•´ì§ˆ ìˆ˜ ìˆê² ì§€ë§Œ, try, catch, final ê°ê°ì˜ ìœ„ì¹˜ì—ì„œ í•„ìš”í•œ ì •ë³´ê°€ ìˆìœ¼ë©° ì¤‘ë³µ ì½”ë“œê°€ ê¹”ë”í•˜ê²Œ ì¡´ì¬í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ì—¬ëŸ¬ ê³³ì— í¼ì ¸ì„œ ì¡´ì¬í•œë‹¤.

ë”°ë¼ì„œ ì¤‘ë³µ ì½”ë“œë¥¼ ì œê±°í•˜ê³ ì í•˜ë©´ ì‘ì—…ì´ ìƒê°ë³´ë‹¤ ë³µì¡í•´ì§€ê³  ìµœëŒ€í•œ ê¹”ë”í•˜ê²Œ í•´ë³´ë©´ ê¸°ì¡´ì˜ í˜•íƒœë¥¼ ë§ì´ ë³€ê²½í•˜ê²Œ ë˜ì–´ ê°€ë…ì„±ì´ ë–¨ì–´ì§ˆ ë¿ë”ëŸ¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì†Œë“œê°€ ë³€ê²½ë˜ê³  ì•ˆì¢‹ì€ ìƒí™©ì´ ë‚˜íƒ€ë‚œë‹¤.

ê·¸ë ‡ë‹¤ë©´ ë‹¤ë¥¸ ë°©ë²•ì€ ì—†ì„ê¹Œ?

### AOP ì‚¬ìš©í•˜ì—¬ Lock íšë“ê³¼ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë¶„ë¦¬

SpringBootì˜ AOPë¥¼ ì´ìš©í•˜ë©´ ê³µí†µì ì¸ ë¡œì§ê³¼ ê°ê°ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ê¹”ë”í•˜ê²Œ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤.

ë”°ë¼ì„œ ë‚˜ëŠ” SpringBootì˜ AOPë¥¼ í™œìš©í•˜ì—¬ êµ¬í˜„í•˜ê¸°ë¡œ í–ˆë‹¤.

```java
public class DistributeLockPointCut {
    @Pointcut("execution(* com.postgraduate.domain.mentoring.application.usecase.MentoringManageUseCase.*(..)) " +
            "&& !execution(* com.postgraduate.domain.mentoring.application.usecase.MentoringManageUseCase.sendFinishMessage(..)) " +
            "&& !execution(* com.postgraduate.domain.mentoring.application.usecase.MentoringManageUseCase.applyMentoring(..))"
    )
    public void allMentoringService() {}
}
```

ìš°ì„  ìœ„ì™€ ê°™ì´ AOPë¥¼ ì ìš©í•  PointCutì„ ì •ì˜í•˜ì˜€ëŠ”ë°, ì´ì „ì— ì‚´í´ë³¸ ê²ƒê³¼ ê°™ì´ ë¶„ì‚°ë½ì„ ì‚¬ìš©í•˜ì§€ ì•Šì„ ë‘ê°œì˜ ë©”ì†Œë“œë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ë©”ì†Œë“œëŠ” ëª¨ë‘ AOPë¥¼ ì ìš©í•˜ë„ë¡ í–ˆë‹¤.

```java
@Aspect
@Slf4j
@Component
@RequiredArgsConstructor
public class DistributeLockAspect {
    private final RedissonClient redissonClient;
    private final static String PREFIX = "mentoring";

    @Around("com.postgraduate.global.aop.lock.DistributeLockPointCut.allMentoringService()")
    public Object startDistributeLock(ProceedingJoinPoint joinPoint) throws Throwable {
        String lockKey = null;
        Object[] args = joinPoint.getArgs();
        for (Object arg : args) {
            if (arg instanceof Long) {
                lockKey = PREFIX + arg;
            }
        }
        RLock lock = redissonClient.getLock(lockKey);

        try {
            boolean available = lock.tryLock(5, 5, SECONDS);
            if (!available)
                throw new LockException();
            log.info("lock íšë“ {}", lockKey);
            return joinPoint.proceed();
        } catch (Exception e) {
            log.error("ì˜ˆì™¸ ë°œìƒ {}", e.getMessage());
            throw e;
        } finally {
            lock.unlock();
            log.info("lock ë°˜ë‚© {}", lockKey);
        }
    }
}
```

ê·¸ë¦¬ê³  ìœ„ì™€ ê°™ì´ ë¶„ì‚°ë½ì„ ìˆ˜í–‰í•  Aspectë¥¼ ì‘ì„±í•˜ì˜€ëŠ”ë° `@Around` ë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì†Œë“œ ì‹¤í–‰ ì „í›„ ëª¨ë‘ ë™ì‘í•˜ë„ë¡ í•˜ì˜€ë‹¤.

ì´ì–´ì„œ ë‚´ë¶€ ë¡œì§ì„ ì‚´í´ë³´ì.

ìš°ì„ , í‚¤ê°’ì„ ìœ„í•´ íŒŒë¼ë¯¸í„° ê°’ì´ í•„ìš”í•œë° `MentoringManageUseCase` ì—ì„œ ë¶„ì‚°ë½ì„ ì ìš©í•  ë©”ì†Œë“œëŠ” Longì„ ë‘ê°œ ì´ìƒ ë°›ì§€ ì•Šê¸° ë•Œë¬¸ì— ë„˜ì–´ì˜¤ëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ê²€ì‚¬í•˜ì—¬ Long íƒ€ì…ì˜ íŒŒë¼ë¯¸í„°ê°€ mentoringId ë¼ê³  ê°€ì •í•˜ê³  ì§„í–‰ì„ í•  ìˆ˜ ìˆì—ˆë‹¤.

ê·¸ë ‡ê²Œ â€˜mentoring mentoringId ê°€ LockKeyê°€ ë˜ì–´ ë½ì„ íšë“í•˜ê³  ë°˜í™˜í•˜ë„ë¡ êµ¬í˜„í•˜ì˜€ìœ¼ë©° ë‚´ìš©ì„ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

ìš°ì„  redissonClientë¥¼ í†µí•´ ì›í•˜ëŠ” LockKeyì˜ ì´ë¦„ìœ¼ë¡œ RLockì„ ì–»ì–´ì˜¤ê³  `lock.tryLock` ì„ í†µí•´ ë½ íšë“ì„ ì‹œë„í•œë‹¤.

ì—¬ê¸°ì„œ `lock.tryLock(5, 5, SECONDS)` ë¥¼ ì‚´í´ë³´ë©´ ë°›ê³ ìˆëŠ” íŒŒë¼ë¯¸í„°ëŠ” ìˆœì„ ëŒ€ë¡œ ìµœëŒ€ ì–¼ë§ˆë‚˜ ê¸°ë‹¤ë¦´ ê²ƒì¸ê°€, ìµœëŒ€ ì–¼ë§ˆë‚˜ ë½ì„ íšë“í•œ ì±„ë¡œ ìˆì„ ê²ƒì¸ê°€, ë‹¨ìœ„ëŠ” ë¬´ì—‡ì¸ê°€ ì´ë©° ìš°ì„ ì€ 5ì´ˆë¡œ ì„¤ì •í•˜ì˜€ê³  ë§Œì•½ ì–»ì§€ ëª»í•œë‹¤ë©´ availableì´ falseê°€ ë˜ì–´ ì•„ë˜ì—ì„œ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¤ê³  ì‹¤íŒ¨í•œë‹¤.

ê·¸ë ‡ê²Œ ë½ì„ íšë“í•˜ëŠ”ë° ì„±ê³µí•˜ê²Œ ë˜ë©´ ë¡œê·¸ë¥¼ ë‚¨ê¸°ê³  `joinPoint.proceed()` ë¥¼ í†µí•´ ì‹¤ì œ í˜¸ì¶œëœ ë©”ì†Œë“œë¥¼ ì‹¤í–‰ì‹œì¼œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•œë‹¤.

ê·¸ë¦¬ê³  finally ë¥¼ í†µí•´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰ì´ ë˜ê±°ë‚˜ ì‹¤íŒ¨ë¥¼ í•˜ê±°ë‚˜ ìƒê´€ ì—†ì´ ì†Œìœ ì¤‘ì¸ ë½ì„ ë°˜í™˜í•˜ë„ë¡ í•˜ë©° AOPê°€ ë§ˆë¬´ë¦¬ëœë‹¤.

ì´ë ‡ê²Œ ë¶„ì‚°ë½ì„ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ë¡œì§ê³¼ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë¶„ë¦¬í•˜ì—¬ AOPë¥¼ ì‚¬ìš©í•˜ë©° ì´ì „ì˜ ì½”ë“œë³´ë‹¤ ê¹”ë”í•˜ê³  ê°€ë…ì„± ì¢‹ì€ ì½”ë“œë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.
