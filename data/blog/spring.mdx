---
title: 'ìŠ¤í”„ë§ ë°°ì¹˜ ë„ì…ê³¼ ì´ë¥¼ í†µí•œ ì„±ëŠ¥ ê°œì„ ê¸°(ë°ì´í„° 3000ê°œ ê¸°ì¤€)'
date: '2024-05-15'
tags: ['Backend']
draft: false
summary: 'ìŠ¤í”„ë§ ë°°ì¹˜ ë„ì…ê³¼ ì´ë¥¼ í†µí•œ ì„±ëŠ¥ ê°œì„ ê¸°(ë°ì´í„° 3000ê°œ ê¸°ì¤€)'
images: []
---

ğŸ¦¡ ì‘ì„±ì : ì›ì¤€

## ê¸°ì¡´ ë°©ì‹

íŠ¸ëœì­ì…˜ ë²”ìœ„ ì¡°ì ˆì„ í†µí•œ ê°±ì‹ 

## ë³€ê²½ëœ ë°©ì‹

SpringBatch ì ìš© WithChunk(Size = 50)

## ë©˜í† ë§ ìë™ ì™„ë£Œ

### ê¸°ì¡´ ì½”ë“œ

```java
@Service
@Slf4j
@RequiredArgsConstructor
public class MentoringManageUseCase {
		...

    @Scheduled(cron = "0 59 23 * * *", zone = "Asia/Seoul")
    public void updateAutoDone() {
        List<Mentoring> expectedMentorings = mentoringGetService.byExpected();
        expectedMentorings.stream()
                .filter(mentoring -> {
                    try {
                        return mentoring.checkAutoDone();
                    } catch (Exception ex) {
                        slackErrorMessage.sendSlackError(mentoring, ex);
                        return false;
                    }
                })
                .forEach(mentoringRenewalUseCase::updateDoneWithAuto);
    }

    ...
}

@RequiredArgsConstructor
@Service
@Transactional
@Slf4j
public class MentoringRenewalUseCase {
    ...

    public void updateDoneWithAuto(Mentoring mentoring) {
        try {
            Mentoring doneMentoring = mentoringGetService.byMentoringIdWithLazy(mentoring.getMentoringId());
            Senior senior = mentoring.getSenior();
            Salary salary = salaryGetService.bySenior(senior);
            salaryUpdateService.plusTotalAmount(salary, doneMentoring.calculateForSenior());
            mentoringUpdateService.updateDone(doneMentoring, salary);
            log.info("mentoringId : {} ìë™ ì™„ë£Œ", mentoring.getMentoringId());
        } catch (Exception ex) {
            slackErrorMessage.sendSlackError(mentoring, ex);
            log.error("mentoringId : {} ìë™ ì™„ë£Œ ì‹¤íŒ¨", mentoring.getMentoringId());
            log.error(ex.getMessage());
            currentTransactionStatus().setRollbackOnly();
        }
    }
}
```

ì§„í–‰ ì˜ˆì • ìƒíƒœì˜ ë©˜í† ë§ì„ ì¡°ê±´ì´ ë§Œì¡±ë˜ëŠ” ê²½ìš° ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½í•˜ê³ , ì„ ë°° ì •ì‚° ê¸ˆì•¡ì„ ì—…ë°ì´íŠ¸ í•˜ëŠ” ê¸°ì¡´ì˜ ë¡œì§ì´ë‹¤.

ìš°ì„ , í•´ë‹¹ ìƒíƒœì˜ ëª¨ë“  ë©˜í† ë§ì„ ì¡°íšŒí•˜ê³  `stream().filter()` ë¥¼ í†µí•´ íŠ¹ì • ì¡°ê±´ì— ë§Œì¡±í•˜ëŠ” ë©˜í† ë§ì„ ê³¨ë¼ë‚¸ í›„ ê°ê°ì˜ ë©˜í† ë§ì— ëŒ€í•´ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ë°©ì‹ì´ë‹¤.

ì´ë•Œ, ì¤‘ê°„ì— í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ì „ì²´ê°€ ë¡¤ë°±ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ê³  ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•˜ì—¬ ë©˜í† ë§ ì—…ë°ì´íŠ¸ì— ëŒ€í•´ ë³„ë„ì˜ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬ í›„ ê°ê°ì˜ ë©˜í† ë§ì— ëŒ€í•´ íŠ¸ëœì­ì…˜ ì„¤ì •ì„ í•˜ì˜€ê³ , ê°ê°ì˜ ë©˜í† ë§ë³„ë¡œ íŠ¸ëœì­ì…˜ì´ ê±¸ë¦¬ë„ë¡ í•˜ì—¬ ë§Œì•½ ì¤‘ê°„ì— íŠ¹ì • ë©˜í† ë§ì—ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ë©´ í•´ë‹¹ ë©˜í† ë§ë§Œ ë¡¤ë°± ì²˜ë¦¬ í›„ ë‚˜ë¨¸ì§€ëŠ” ëª¨ë‘ ì •ìƒì²˜ë¦¬ ë  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤.

---

### ë³€ê²½ ì½”ë“œ

```java
@Configuration
@RequiredArgsConstructor
public class DoneJobConfig {
    private final JobRepository jobRepository;
    private final PlatformTransactionManager transactionManager;
    private final DataSource dataSource;
    private final DoneMentoringProcessor doneMentoringProcessor;
    private final DoneMentoringWriter doneMentoringWriter;

    private static final int CHUNK_SIZE = 50;

    @Bean(name = "doneJob")
    public Job doneJob() throws Exception {
        return new JobBuilder("doneJob", jobRepository)
                .start(doneStep())
                .build();
    }

    @Bean(name = "doneStep")
    public Step doneStep() throws Exception {
        return new StepBuilder("doneStep", jobRepository)
                .<DoneMentoring, DoneMentoring>chunk(CHUNK_SIZE, transactionManager)
                .reader(doneReader())
                .processor(doneMentoringProcessor)
                .writer(doneMentoringWriter)
                .faultTolerant()
                .skip(Exception.class)
                .skipLimit(Integer.MAX_VALUE)
                .build();
    }

    @Bean(name = "doneReader")
    public JdbcPagingItemReader<DoneMentoring> doneReader() throws Exception {
        return new JdbcPagingItemReaderBuilder<DoneMentoring>()
                .pageSize(CHUNK_SIZE)
                .fetchSize(CHUNK_SIZE)
                .dataSource(dataSource)
                .rowMapper(new DoneMentoringRowMapper())
                .queryProvider(doneQueryProvider())
                .name("doneReader")
                .build();
    }

    @Bean(name = "doneQuery")
    public PagingQueryProvider doneQueryProvider() throws Exception {
        SqlPagingQueryProviderFactoryBean queryProvider = new SqlPagingQueryProviderFactoryBean();
        queryProvider.setDataSource(dataSource);
        queryProvider.setSelectClause("select m.mentoring_id, m.senior_senior_id, m.salary_salary_id, m.date, p.pay");
        queryProvider.setFromClause("from mentoring m join payment p on m.payment_payment_id = p.payment_id");
        queryProvider.setWhereClause("where m.status = 'EXPECTED'");
        queryProvider.setSortKey("mentoring_id");
        return queryProvider.getObject();
    }
}

@Component
public class DoneMentoringProcessor implements ItemProcessor<DoneMentoring, DoneMentoring> {
    @Override
    public DoneMentoring process(DoneMentoring doneMentoring) {
        DateTimeFormatter formatter = ofPattern("yyyy-MM-dd-HH-mm");
        LocalDateTime doneDate = parse(doneMentoring.date(), formatter);
        if (now().minusDays(3)
                .isAfter(doneDate))
            return doneMentoring;
        return null;
    }
}

@Component
@RequiredArgsConstructor
@Slf4j
public class DoneMentoringWriter implements ItemWriter<DoneMentoring> {
    private final DoneMentoringRepository doneMentoringRepository;

    @Override
    public void write(Chunk<? extends DoneMentoring> chunk) {
        List<DoneMentoring> doneMentorings = new ArrayList<>();
        chunk.forEach(doneMentorings::add);
        doneMentoringRepository.updateAllMentoring(doneMentorings);
        doneMentoringRepository.updateAllSalary(doneMentorings);
        log.info("ë©˜í† ë§ ìë™ ì™„ë£Œ size : {}", chunk.size());
    }
}

@Component
@RequiredArgsConstructor
public class DoneMentoringRepository {
    private final NamedParameterJdbcTemplate jdbcTemplate;
    private static final int CHARGE = TermUnit.SHORT.getCharge();
    private static final String UPDATE_MENTORING = "update mentoring set status = 'DONE' where mentoring_id = :mentoringId";
    private static final String UPDATE_SALARY = "update salary set total_amount = total_amount + :amount where salary_id = :salaryId";

    public void updateAllSalary(List<DoneMentoring> mentorings) {
        jdbcTemplate.batchUpdate(UPDATE_SALARY, generateParameterSource(mentorings));
    }

    public void updateAllMentoring(List<DoneMentoring> mentorings) {
        jdbcTemplate.batchUpdate(UPDATE_MENTORING, generateParameterSource(mentorings));
    }

    private SqlParameterSource[] generateParameterSource(List<DoneMentoring> mentorings) {
        return mentorings.stream()
                .map(mentoring -> new MapSqlParameterSource(generateEntityParams(mentoring)))
                .toArray(SqlParameterSource[]::new);
    }

    private Map<String, Object> generateEntityParams(DoneMentoring doneMentoring) {
        HashMap<String, Object> parameter = new HashMap<>();
        parameter.put("mentoringId", doneMentoring.mentoringId());
        parameter.put("amount", doneMentoring.pay() - CHARGE);
        parameter.put("salaryId", doneMentoring.salaryId());
        return parameter;
    }
}

@Component
@RequiredArgsConstructor
@Slf4j
public class DoneMentoringSkipListener implements SkipListener<DoneMentoring, DoneMentoring> {
    private final SlackErrorMessage slackErrorMessage;

    @Override
    public void onSkipInRead(Throwable t) {
        log.info("ë©˜í† ë§ ìë™ ì™„ë£Œ ItemReader Skip message : {}", t.getMessage());
    }

    @Override
    public void onSkipInProcess(DoneMentoring doneMentoring, Throwable t) {
        log.info("mentoringId : {} ìë™ ì™„ë£Œ ì‹¤íŒ¨, message : {}", doneMentoring.mentoringId(), t.getMessage());
        slackErrorMessage.sendSlackMentoringError(doneMentoring.mentoringId(), t);
    }

    @Override
    public void onSkipInWrite(DoneMentoring doneMentoring, Throwable t) {
        log.info("mentoringId : {} ìë™ ì™„ë£Œ ì‹¤íŒ¨, message : {}", doneMentoring.mentoringId(), t.getMessage());
        slackErrorMessage.sendSlackMentoringError(doneMentoring.mentoringId(), t);
    }
}
```

ê¸°ì¡´ì˜ ë°°ì¹˜ ì²˜ë¦¬ë¥¼ ìŠ¤í”„ë§ ë°°ì¹˜ í”„ë ˆì„ ì›Œí¬ë¥¼ í™œìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë¦¬íŒ©í† ë§ í•˜ì˜€ë‹¤.

Chunk ê¸°ë°˜ìœ¼ë¡œ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ë¥¼ í•˜ëŠ” ë°©ì‹ì´ë©° ì„œë²„ì˜ ìŠ¤í™ìƒ 10~100 ì •ë„ì˜ ChunkSizeë¥¼ ê¶Œì¥í•˜ê³  ìˆê¸°ì— ì¤‘ê°„ ê°’ì¸ 50ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ìˆ˜í–‰í•˜ì˜€ë‹¤.

`reader` ì—ì„œ ê¸°ì¡´ê³¼ ê°™ì´ ë©˜í† ë§ì„ ì¡°íšŒí•˜ë©°, `processor` ì—ì„œ `stream().filter()` ì—ì„œ ìˆ˜í–‰í•˜ë˜ ì—­í• ì„ ì§„í–‰í•˜ë„ë¡ í•˜ì˜€ë‹¤.

ê·¸ë¦¬ê³  `writer` ì—ì„œ ì°¨ì´ê°€ ë°œìƒí•˜ëŠ”ë°, Chunk ë‹¨ìœ„ë¡œ ë™ì‘ì„ í•˜ê¸° ë•Œë¬¸ì— í•œë²ˆì— ìµœëŒ€ 50ê°œë¥¼ í•œë²ˆì— Insert ë° Updateë¥¼ ìˆ˜í–‰í•˜ë„ë¡ í•˜ì˜€ë‹¤.

ì´ë¥¼ í†µí•´ 1ê°œì”© ìˆ˜í–‰í•˜ë˜ ê¸°ì¡´ê³¼ ë‹¤ë¥´ê²Œ 50ê°œ ë‹¨ìœ„ë¡œ ì²˜ë¦¬í•˜ë©° ì˜¤ë¥˜ ë°œìƒì‹œ í•´ë‹¹ ë°ì´í„°ë§Œ ìŠ¤í‚µí•˜ê³  í•´ë‹¹ Chunkë¥¼ ë‹¤ì‹œ ì‹œì‘í•˜ë„ë¡ í•˜ì—¬ ê¸°ì¡´ì˜ ì˜¤ë¥˜ ì œì–´ëŠ” ê·¸ëŒ€ë¡œ ê°€ì ¸ê°€ë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤.

ë§ˆì°¬ê°€ì§€ë¡œ `skipListener` ë¥¼ í†µí•´ ê¸°ì¡´ê³¼ ê°™ì´ ì˜¤ë¥˜ ë°œìƒì‹œ ìŠ¬ë™ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê³  ë¡œê·¸ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ ë˜í•œ ìœ ì§€í•˜ë„ë¡ í•˜ë©° ì„±ëŠ¥ í–¥ìƒì„ ê°€ì ¸ì™”ë‹¤.

â­Â **ê²°ê³¼ : 2ë¶„ 12ì´ˆ â†’ 2ì´ˆ** â­

## ì •ì‚° ìë™ ìƒì„±

### ê¸°ì¡´ ì½”ë“œ

```java
@Service
@RequiredArgsConstructor
public class SalaryManageUseCase {
    ...

    @Scheduled(cron = "0 0 0 * * 4", zone = "Asia/Seoul")
    public void createSalary() {
        List<Salary> salaries = salaryGetService.findAllLast();
        slackSalaryMessage.sendSlackSalary(salaries);

        List<SeniorAndAccount> seniorAndAccounts = seniorGetService.findAllSeniorAndAccount();
        LocalDate salaryDate = getSalaryDate().plusDays(7);
        seniorAndAccounts.stream()
                .filter(seniorAndAccount -> salaryGetService.bySeniorOptional(seniorAndAccount.senior(), salaryDate).isEmpty())
                .forEach(seniorAndAccount -> salaryRenewalUseCase.createSalaryWithAuto(seniorAndAccount, salaryDate));
    }
}

@RequiredArgsConstructor
@Service
@Transactional
@Slf4j
public class SalaryRenewalUseCase {
    private final SalarySaveService salarySaveService;

    public void createSalaryWithAuto(SeniorAndAccount seniorAndAccount, LocalDate salaryDate) {
        Salary salary = SalaryMapper.mapToSalary(seniorAndAccount.senior(), salaryDate, seniorAndAccount.account());
        salarySaveService.save(salary);
    }
}
```

1ì£¼ì¼ì— í•œë²ˆì”© ì¼ê´„ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ìœ¼ë¡œ, ì„ ë°° ê°ê°ì— ëŒ€í•´ì„œ ìƒˆë¡œìš´ ì •ì‚° ë°ì´í„°ë¥¼ ìƒì„±í•˜ëŠ” ë¡œì§ì´ë‹¤.

ìš°ì„  ì´ë²ˆ ì •ì‚°ì„ ëª¨ë‘ ì¡°íšŒí•œ í›„ ìŠ¬ë™ìœ¼ë¡œ ì•Œë¦¼ì„ ë³´ë‚´ë„ë¡ í•˜ì˜€ê³ , ì´í›„ ê° ì„ ë°°ì˜ ê³„ì¢Œì™€ ì„ ë°° ì •ë³´ë¥¼ ì¡°íšŒí•œ í›„ í•´ë‹¹ ì •ë³´ë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ ì •ì‚°ì„ ìƒˆë¡­ê²Œ ìƒì„±í•˜ëŠ” ê²ƒì´ë‹¤.

ì´ë•Œ, ë©˜í† ë§ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì¤‘ê°„ì— í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ì „ì²´ê°€ ë¡¤ë°± ë˜ëŠ” ê²½ìš°ê°€ ë°œìƒí•˜ì˜€ê³  ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì •ì‚° ìƒì„±ì„ ë³„ë„ì˜ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬ í›„ ê°ê°ì˜ ì„ ë°°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ íŠ¸ëœì­ì…˜ ë²”ìœ„ë¥¼ ì„¤ì •í•˜ì—¬ íŠ¹ì • ì„ ë°°ì˜ ì²˜ë¦¬ì—ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ë©´ í•´ë‹¹ ë°ì´í„°ë§Œ ë¡¤ë°±í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” ì •ìƒ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤.

---

### ë³€ê²½ ì½”ë“œ

```java
@Configuration
@RequiredArgsConstructor
@Slf4j
public class CreateSalaryJobConfig {
    private final JobRepository jobRepository;
    private final PlatformTransactionManager transactionManager;
    private final SlackSalaryMessage slackSalaryMessage;
    private final SalaryGetService salaryGetService;
    private final CreateSalaryItemWriter createSalaryItemWriter;
    private final DataSource dataSource;

    private static final int CHUNK_SIZE = 50;

    @Bean(name = "salaryJob")
    public Job salaryJob() throws Exception {
        return new JobBuilder("salaryJob", jobRepository)
                .start(sendSlackStep())
                .next(createSalaryStep())
                .build();
    }

    @Bean(name = "sendSlackStep")
    public Step sendSlackStep() {
        return new StepBuilder("sendSlackStep", jobRepository)
                .tasklet((contribution, chunkContext) -> {
                    List<Salary> salaries = salaryGetService.findAllLast();
                    slackSalaryMessage.sendSlackSalary(salaries);
                    log.info("salarySize : {}", salaries.size()); // ì„ì‹œ
                    salaries.forEach(salary -> log.info("salary : {}", salary.getTotalAmount())); // ì„ì‹œ
                    return RepeatStatus.FINISHED;
                }, transactionManager)
                .build();
    }

    @Bean(name = "createSalaryStep")
    public Step createSalaryStep() throws Exception {
        return new StepBuilder("createSalaryStep", jobRepository)
                .<CreateSalary, CreateSalary>chunk(CHUNK_SIZE, transactionManager)
                .reader(salaryReader())
                .writer(createSalaryItemWriter)
                .faultTolerant()
                .skip(Exception.class)
                .skipLimit(Integer.MAX_VALUE)
                .build();
    }

    @Bean(name = "salaryReader")
    public JdbcPagingItemReader<CreateSalary> salaryReader() throws Exception {
        Map<String, Object> parameters = new HashMap<>();
        parameters.put("salaryDate", getSalaryDate().plusDays(7));
        return new JdbcPagingItemReaderBuilder<CreateSalary>()
                .pageSize(CHUNK_SIZE)
                .fetchSize(CHUNK_SIZE)
                .dataSource(dataSource)
                .rowMapper(new CreateSalaryRowMapper())
                .queryProvider(salaryQueryProvider())
                .parameterValues(parameters)
                .name("salaryReader")
                .build();
    }

    @Bean(name = "salaryQuery")
    public PagingQueryProvider salaryQueryProvider() throws Exception {
        SqlPagingQueryProviderFactoryBean queryProvider = new SqlPagingQueryProviderFactoryBean();
        queryProvider.setDataSource(dataSource);
        queryProvider.setSelectClause("SELECT s.senior_id, a.bank, a.account_id, a.account_holder, a.account_number");
        queryProvider.setFromClause("FROM senior s\n" +
                "JOIN user u ON s.user_user_id = u.user_id\n" +
                "LEFT JOIN account a ON s.senior_id = a.senior_senior_id");
        queryProvider.setWhereClause("WHERE u.is_delete = false\n" +
                "AND s.senior_id NOT IN (\n" +
                "SELECT senior_senior_id\n" +
                "FROM salary\n" +
                "WHERE salary_date = :salaryDate\n" +
                ")");
        queryProvider.setSortKey("senior_id");
        return queryProvider.getObject();
    }
}

@Component
@RequiredArgsConstructor
@Slf4j
public class CreateSalaryItemWriter implements ItemWriter<CreateSalary> {
    private final CreateSalaryRepository createSalaryRepository;

    @Override
    public void write(Chunk<? extends CreateSalary> chunk) throws Exception {
        List<CreateSalary> createSalaries = new ArrayList<>();
        chunk.forEach(createSalaries::add);
        createSalaryRepository.insertAllSalary(createSalaries);
        log.info("salary ìë™ ìƒì„± ChunkSize : {}", chunk.size());
    }
}

@Component
@RequiredArgsConstructor
public class CreateSalaryRepository {
    private final NamedParameterJdbcTemplate jdbcTemplate;
    private static final String INSERT_SALARY = "insert into salary " +
            "(salary_date, status, total_amount, senior_senior_id, account_holder, account_number, bank) " +
            "values (:salaryDate, false, 0, :seniorId, :accountHolder, :accountNumber, :bank)";

    public void insertAllSalary(List<CreateSalary> createSalaries) {
        jdbcTemplate.batchUpdate(INSERT_SALARY, generateParameterSource(createSalaries));
    }

    private SqlParameterSource[] generateParameterSource(List<CreateSalary> createSalaries) {
        return createSalaries.stream()
                .map(createSalary -> new MapSqlParameterSource(generateEntityParams(createSalary)))
                .toArray(SqlParameterSource[]::new);
    }

    private Map<String, Object> generateEntityParams(CreateSalary createSalary) {
        HashMap<String, Object> parameter = new HashMap<>();
        parameter.put("salaryDate", getSalaryDate().plusDays(7));
        parameter.put("seniorId", createSalary.seniorId());
        parameter.put("accountHolder", createSalary.accountHolder());
        parameter.put("accountNumber", createSalary.accountNumber());
        parameter.put("bank", createSalary.bank());
        return parameter;
    }
}
```

ê¸°ì¡´ì˜ ë°°ì¹˜ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ìŠ¤í”„ë§ ë°°ì¹˜ í”„ë ˆì„ì›Œí¬ë¥¼ í™œìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë¦¬íŒ©í† ë§ í•˜ì˜€ë‹¤.

ChunkSize ì„¤ì •ì€ ë©˜í† ë§ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì •í•˜ì˜€ë‹¤.

`Tasklet` ê³¼ `Chunk` ë‘ê°€ì§€ë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ì˜€ìœ¼ë©° `Tasklet` ì—ì„œ ê¸°ì¡´ê³¼ ê°™ì´ í•œë²ˆì— ëª¨ë“  ì •ì‚°ì„ ì½ì€ í›„ ì •ì‚° ì˜ˆì • ê¸ˆì•¡ì„ ìŠ¬ë™ìœ¼ë¡œ ì „ì†¡í•œ í›„ `Chunk` ë‹¨ìœ„ë¡œ ìƒˆë¡œìš´ ì •ì‚°ì„ ìƒì„±í•˜ë„ë¡ í•˜ì˜€ë‹¤.

`reader` ì—ì„œ ê¸°ì¡´ê³¼ ê°™ì´ ì •ì‚° ìƒì„±ì„ ìœ„í•œ ì¡°íšŒë¥¼ ì§„í–‰í•˜ëŠ”ë°, ê¸°ì¡´ì˜ `stream().ilter()` ì—ì„œ ì²˜ë¦¬í•˜ëŠ” ë‚´ìš©ì„ SQLì„ í†µí•´ ì²˜ë¦¬í•œ í›„ ë°”ë¡œ `writer` ë¡œ ë„˜ê¸°ë„ë¡ í•˜ì˜€ë‹¤.

ê·¸ë¦¬ê³  `writer` ì—ì„œ ì°¨ì´ê°€ ë°œìƒí•˜ëŠ”ë°, ë§ˆì°¬ê°€ì§€ë¡œ í•œë²ˆì— ìµœëŒ€ 50ê°œë¥¼ í•œë²ˆì— Insert ë° Updateë¥¼ ìˆ˜í–‰í•˜ë„ë¡ í•˜ì˜€ìœ¼ë©° 1ê°œì”© ìˆ˜í–‰í•˜ë˜ ê¸°ì¡´ê³¼ ë‹¤ë¥´ê²Œ 50ê°œ ë‹¨ìœ„ë¡œ ì²˜ë¦¬í•˜ë©° ì˜¤ë¥˜ ë°œìƒì‹œ í•´ë‹¹ ë°ì´í„°ë§Œ ìŠ¤í‚µí•˜ê³  í•´ë‹¹ Chunkë¥¼ ë‹¤ì‹œ ì‹œì‘í•˜ë„ë¡ í•˜ì—¬ ê¸°ì¡´ì˜ ì˜¤ë¥˜ ì œì–´ëŠ” ê·¸ëŒ€ë¡œ ê°€ì ¸ê°€ë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤.

ë§ˆì°¬ê°€ì§€ë¡œ `skipListener` ë¥¼ í†µí•´ ê¸°ì¡´ê³¼ ê°™ì´ ì˜¤ë¥˜ ë°œìƒì‹œ ìŠ¬ë™ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê³  ë¡œê·¸ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ ë˜í•œ ìœ ì§€í•˜ë„ë¡ í•˜ë©° ì„±ëŠ¥ í–¥ìƒì„ ê°€ì ¸ì™”ë‹¤.

â­Â **ê²°ê³¼ : 1ë¶„ 10ì´ˆ â†’ 2.5ì´ˆ** â­
